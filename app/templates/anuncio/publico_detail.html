{% extends 'base.html' %}
{% block content %}
<h1>{{ anuncio.titulo }}</h1>
<p><strong>Descrição:</strong> {{ anuncio.descricao }}</p>
<p><strong>Preço:</strong> R$ {{ anuncio.preco }}</p>

<p><strong>Categoria:</strong> {{ anuncio.categoria.nome }}</p>
<p><strong>Dono do anúncio:</strong> {{ anuncio.usuario.nome }}</p>
<hr>
<h2>Perguntas e Respostas</h2>
<ul>
    {% for pr in perguntas_respostas %}
        <li>
            <strong>Pergunta:</strong> {{ pr.pergunta.texto }}<br>
            <strong>Usuário:</strong> {{ pr.pergunta.usuario.nome }}<br>
            {% if pr.resposta %}
                <strong>Resposta:</strong> {{ pr.resposta.texto }}
            {% else %}
                <em>Aguardando resposta do vendedor.</em>
                {% if current_user.is_authenticated and anuncio.usuario_id == current_user.id %}
                <form action="{{ url_for('anuncio.responder_pergunta', anuncio_id=anuncio.id, pergunta_id=pr.pergunta.id) }}" method="post" style="margin-top:5px;">
                    <input type="text" name="texto" placeholder="Responder..." required>
                    <button type="submit">Responder</button>
                </form>
                {% endif %}
            {% endif %}
        </li>
    {% endfor %}
</ul>
<hr>

{% if current_user.is_authenticated and anuncio.usuario_id != current_user.id %}
    <form action="{{ url_for('favorito.create_favorito') }}" method="post" style="display:inline;">
        <input type="hidden" name="anuncio_id" value="{{ anuncio.id }}">
        <button type="submit">Favoritar</button>
    </form>
    <form action="{{ url_for('pergunta.nova_pergunta') }}" method="post" style="display:inline;">
        <input type="hidden" name="anuncio_id" value="{{ anuncio.id }}">
        <input type="text" name="texto" placeholder="Faça uma pergunta" required>
        <button type="submit">Perguntar</button>
    </form>
    <form action="{{ url_for('compra.nova_compra') }}" method="post" style="display:inline;">
        <input type="hidden" name="anuncio_id" value="{{ anuncio.id }}">
        <input type="hidden" name="valor_pago" value="{{ anuncio.preco }}">
        <button type="submit">Comprar</button>
    </form>
{% elif not current_user.is_authenticated %}
    <p><a href="{{ url_for('auth.login') }}">Faça login</a> para favoritar, perguntar ou comprar.</p>
{% else %}
    <em>Você é o dono deste anúncio.</em>
{% endif %}
<a href="{{ url_for('anuncio.explorar_anuncios') }}">Voltar para Explorar</a>
{% endblock %}
